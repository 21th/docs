---
deps: ["after", "intro-to-state-api"]
group: running-machines
status: complete # in-progress, complete
needs: # content, tech-review, copy-review
---

Lots of backend code relies on short-running processes, such as backend functions, especially in serverless contexts where code needs to boot up and shut down as fast as possible.

Much of this type of code relies on `async` functions:

```ts twoslash
const myFunc = async () => {};
```

The best pattern to use for async functions is `waitFor`, which allows you to `await` a state machine being in a particular state.

```ts twoslash
import { interpret, createMachine } from "xstate";
import { waitFor } from "xstate/lib/waitFor";

const machine = createMachine({
  initial: "pending",
  states: {
    pending: {
      after: {
        3000: {
          target: "done",
        },
      },
    },
    done: {},
  },
});

const myFunc = async () => {
  const actor = interpret(machine).start();

  const doneState = await waitFor(actor, (state) =>
    state.matches("done"),
  );

  console.log(doneState.value); // 'done'
};
```

In the example above, the machine waits for three seconds before moving on to its `done` state, at which point the `await` will resolve, and the program will move on.

By default, `waitFor` will time out after 10 seconds if the desired state is not reached. You can customize this timeout by passing `timeout` in the options:

```ts twoslash {8-11}
import { interpret, createMachine } from "xstate";
import { waitFor } from "xstate/lib/waitFor";

const machine = createMachine({
  initial: "pending",
  states: {
    pending: {
      after: {
        3000: {
          target: "done",
        },
      },
    },
    done: {},
  },
});

// ---cut---

const myFunc = async () => {
  const actor = interpret(machine).start();

  const doneState = await waitFor(
    actor,
    (state) => state.matches("done"),
    {
      // 20 seconds in ms
      timeout: 20_000,
    },
  );
};
```

`waitFor` will also throw an error if the actor reaches a final state _before_ satisfying the condition. [Read more about final states](/states/final-states).
