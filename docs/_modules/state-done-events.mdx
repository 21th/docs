---
deps:
  [
    "final-states",
    "hierarchical-states",
    "transitions-and-events",
  ]
group: deep-dive-states
status: complete # in-progress, complete
needs: # content, tech-review, copy-review
---

Final states can be used with hierarchical states to make elegant, modular statecharts.

Inside a hierarchical state, reaching a final child state node will fire a `done` event back to the machine. The machine can listen for the `done` event by declaring `onDone` on the state:

```ts twoslash
import { createMachine } from "xstate";

const machine = createMachine({
  initial: "makingCoffee",
  states: {
    makingCoffee: {
      initial: "boilingWater",
      states: {
        boilingWater: {
          on: {
            WATER_BOILED: {
              target: "pouringWaterThroughPod",
            },
          },
        },
        pouringWaterThroughPod: {
          on: {
            WATER_POURED: {
              target: "complete",
            },
          },
        },
        complete: {
          type: "final",
        },
      },
      onDone: {
        target: "coffeeMade",
      },
    },
    coffeeMade: {},
  },
});
```

The machine above has two main states - `makingCoffee` and `coffeeMade`. `makingCoffee` has several sub-steps which end up in a `complete` state. When the machine reaches the `complete` state, it fires a `done` event, meaning the `makingCoffee` state is complete.

Because the machine is listening for `onDone` on `makingCoffee`, the machine then transitions to `coffeeMade`.

Using `onDone` can make large statecharts easier to understand. The example above clearly shows that the overall “story” of the machine is that it makes coffee, then the coffee is done. If you need to know how the coffee is made, you can dive into the details of the `makingCoffee` state.

### `onDone` cannot be defined on the machine’s root

The `onDone` transition cannot be defined on the machine’s root because `onDone` is a transition on a `'done.state.*'` event, and when a machine reaches its final state, it can no longer accept any events.
